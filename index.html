<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººæˆé•·å­¸ç¿’è»Œè·¡ App - æ—¥ç³»æ¥µç°¡é¢¨ (v6.0)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* æ—¥ç³»æ¥µç°¡é¢¨å­—é«”ï¼šä½¿ç”¨ç³»çµ±é è¨­çš„ç„¡è¥¯ç·šå­—é«”ï¼Œç¢ºä¿æ¸…æ™°åº¦ */
        body {
            font-family: 'Inter', 'Noto Sans TC', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #fcfbf8; /* æ•´é«”èƒŒæ™¯ï¼šç±³ç™½è‰²èª¿å»¶ä¼¸ */
        }
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ (åƒ…é©ç”¨æ–¼æ¡Œé¢) */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #d7b57a; border-radius: 2px; }
        ::-webkit-scrollbar-track { background: #fcfbf8; }

        /* é é¦–åœ“å¼§éŠœæ¥æ•ˆæœ */
        .header-curve-mask {
            position: relative;
            z-index: 10;
            margin-top: -50px;
            padding-top: 50px;
            border-top-left-radius: 40px;
            border-top-right-radius: 40px;
            background-color: #ffffff;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
        }

        /* åº•éƒ¨å°èˆªæ¬„ */
        .bottom-nav {
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (Object.keys(firebaseConfig).length > 0) {
            window.firebaseApp = initializeApp(firebaseConfig);
            window.db = getFirestore(window.firebaseApp);
            window.auth = getAuth(window.firebaseApp);
            onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    window.vueApp.userId = user.uid;
                } else if (initialAuthToken) {
                    try { await signInWithCustomToken(window.auth, initialAuthToken); } catch (error) { await signInAnonymously(window.auth); }
                } else { await signInAnonymously(window.auth); }
                window.vueApp.isAuthReady = true;
            });
            window.dbFunctions = { doc, collection, query, onSnapshot, addDoc, setDoc, updateDoc, deleteDoc, serverTimestamp };
        } else {
            console.error("Firebase é…ç½®æœªè¼‰å…¥ã€‚App å°‡ä»¥æ¨¡æ“¬æ¨¡å¼é‹è¡Œ (ç„¡æ³•æŒä¹…å„²å­˜è³‡æ–™)ã€‚");
            window.vueApp.isAuthReady = true;
        }
    </script>
</head>
<body class="antialiased min-h-screen">
    <div id="app" class="max-w-xl mx-auto min-h-screen bg-stone-50 pb-20">

        <header class="h-[250px] relative overflow-hidden bg-amber-100">
            <img src="https://placehold.co/1920x400/fff3e0/333?text=Growth+Tracker+App+Banner"
                 alt="App Banner"
                 class="absolute inset-0 w-full h-full object-cover opacity-80"
                 onerror="this.onerror=null;this.src='https://placehold.co/1920x400/fff3e0/333?text=Growth+Tracker+App+Banner'">
            <div class="absolute top-0 left-0 right-0 p-4 text-white text-center font-bold text-2xl z-20">
                ğŸš€ å€‹äººæˆé•·è»Œè·¡
            </div>
            <div class="absolute bottom-0 left-0 right-0 h-16 bg-stone-50"
                 style="border-top-left-radius: 40px; border-top-right-radius: 40px; transform: translateY(40px);">
            </div>
        </header>

        <main class="p-4 relative bg-white header-curve-mask min-h-[calc(100vh-250px)]">

            <div v-show="activeTab === 'daily'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“… {{ formatDate(currentDate, 'MMæœˆDDæ—¥') }} èª²è¡¨</h2>

                <div class="flex space-x-2 overflow-x-auto pb-4 sticky top-0 bg-white z-20 shadow-sm border-b">
                    <div v-for="day in dateRange" :key="day.dateString"
                         @click="selectDate(day.date)"
                         :class="['flex-shrink-0 w-16 h-16 rounded-xl p-1 text-center cursor-pointer transition',
                                   day.isToday ? 'bg-amber-100 shadow-md border-2 border-amber-300' : 'bg-stone-50',
                                   day.isSelected ? 'bg-amber-400 text-white font-bold transform scale-105' : 'text-stone-700']">
                        <div class="text-xs opacity-70">{{ day.dayOfWeek }}</div>
                        <div class="text-2xl leading-none font-bold">{{ day.dayOfMonth }}</div>
                    </div>
                </div>

                <div class="my-4">
                    <select v-model="selectedCourseFilter"
                            class="w-full p-3 rounded-xl border border-stone-200 bg-stone-50 text-stone-700 text-sm focus:ring-amber-400 focus:border-amber-400">
                        <option value="All">æ‰€æœ‰ä»»å‹™</option>
                        <option v-for="course in courses" :value="course.id" :key="course.id">
                            {{ course.name }}
                        </option>
                    </select>
                </div>

                <div v-if="filteredTasks.length" class="space-y-3">
                    <div v-for="(task, index) in filteredTasks" :key="task.id"
                         :class="['p-4 rounded-xl shadow-md border-l-4 transition duration-300',
                                   task.completed ? 'bg-stone-100 border-green-400 opacity-70' : 'bg-white border-amber-400']">
                        
                        <div class="flex items-center justify-between mb-2 text-stone-400 text-xs">
                            <span class="font-medium text-stone-600">{{ getCourseName(task.courseId) }}</span>
                            <i class="ph ph-dots-three-vertical cursor-pointer"></i>
                        </div>

                        <div class="flex items-center justify-between">
                            <div :class="['flex-1 mr-4', task.completed ? 'line-through text-stone-500' : 'text-stone-800']">
                                <p class="font-semibold text-lg">{{ task.content }}</p>
                            </div>

                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-amber-600 font-medium flex-shrink-0">
                                    {{ task.estimatedTime }} åˆ†é˜
                                </span>
                                <input type="checkbox" :checked="task.completed"
                                       @change="toggleTaskCompletion(task.id, $event.target.checked)"
                                       class="h-6 w-6 text-green-600 rounded border-stone-300 focus:ring-green-500 cursor-pointer flex-shrink-0">
                            </div>
                        </div>

                        <div class="mt-3 border-t pt-3 flex justify-between items-center text-sm">
                            <span v-if="task.completed" class="text-xs text-green-600 font-medium">
                                å®Œæˆæ–¼: {{ formatDate(task.completedAt, 'HH:mm') }}
                            </span>
                            <button v-else
                                    class="px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white text-xs font-semibold rounded-full transition shadow-md">
                                <i class="ph ph-play-fill mr-1"></i> é–‹å§‹è¨ˆæ™‚ (Timer Placeholder)
                            </button>
                            <span class="text-xs text-stone-500">
                                å¯¦éš›è€—æ™‚: {{ task.actualTime || '0' }} åˆ†é˜
                            </span>
                        </div>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-calendar-blank text-3xl mb-2"></i>
                    <p>æœ¬æ—¥ç„¡æ’ç¨‹ä»»å‹™ï¼Œé»æ“Šå³ä¸‹è§’ '+' æ–°å¢ã€‚</p>
                </div>

                <div class="mt-8">
                    <details class="rounded-xl bg-stone-50 p-4 border border-stone-200">
                        <summary class="font-semibold text-stone-700 cursor-pointer">
                            ğŸ“ ä»Šæ—¥å¿ƒå¾—èˆ‡åæ€ (R) - èª²ç¨‹ 6
                        </summary>
                        <textarea rows="4" placeholder="è¼¸å…¥æ‚¨ä»Šæ—¥çš„åæ€ã€æŒ‘æˆ°æˆ–çªç ´..."
                                  class="w-full mt-3 p-3 text-sm rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400"></textarea>
                        <button class="w-full mt-2 py-2 bg-stone-700 text-white rounded-lg hover:bg-stone-800 transition">
                            å„²å­˜å¿ƒå¾—
                        </button>
                    </details>
                </div>
            </div>

            <div v-show="activeTab === 'overview'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“š èª²ç¨‹ç¸½è¦½</h2>

                <div class="mb-6 p-4 bg-amber-100 rounded-xl shadow-sm border border-amber-200">
                    <p class="text-sm text-stone-600 mb-1">æ‰€æœ‰èª²ç¨‹ç¸½è¨ˆå¯¦éš›åŸ·è¡Œæ™‚é–“</p>
                    <p class="text-3xl font-extrabold text-stone-800">{{ totalActualTime }} å°æ™‚</p>
                    <small class="text-xs text-stone-500">æœ¬æœˆ/æœ¬é€±ç¯©é¸åŠŸèƒ½å¾…é–‹ç™¼...</small>
                </div>

                <div class="space-y-6">
                    <div v-for="course in courses" :key="course.id"
                         @click="detailCourse = (detailCourse && detailCourse.id === course.id) ? null : course"
                         :class="['p-5 bg-white rounded-xl shadow-lg border-l-4 border-amber-500 cursor-pointer transition hover:shadow-xl hover:scale-[1.01]',
                                   detailCourse && detailCourse.id === course.id ? 'shadow-2xl scale-[1.02] bg-amber-50' : '']">
                        
                        <h3 class="text-xl font-bold text-stone-800 mb-1">{{ course.name }} (èª²ç¨‹ {{ course.id }})</h3>
                        <p class="text-sm text-stone-600 mb-3 italic">ç›®æ¨™: {{ course.goal }}</p>

                        <div class="w-full bg-stone-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full bg-amber-500 transition-all duration-500"
                                 :style="{ width: courseProgress[course.id] + '%' }"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-1 text-stone-500">
                            <span>å·²å®Œæˆ: {{ course.completedCount }} / {{ course.totalTasks }}</span>
                            <span class="font-bold text-amber-700">{{ courseProgress[course.id] }}%</span>
                        </div>

                        <div v-if="detailCourse && detailCourse.id === course.id" class="mt-6 pt-4 border-t border-stone-200">
                            <p class="font-semibold text-amber-700 mb-2">ğŸ’¡ é æœŸæˆæœ:</p>
                            <p class="text-sm text-stone-700 mb-4">{{ course.outcome }}</p>

                            <h4 class="font-semibold text-stone-700 mb-3 border-b pb-1 flex justify-between items-center">
                                å­¸ç¿’å…§å®¹æ¸…å–® (A-R é …ç›®)
                                <button @click.stop="openModal('NewLearningContent', { courseId: course.id })" 
                                        class="text-amber-500 hover:text-amber-600 text-xs font-medium flex items-center">
                                    <i class="ph ph-plus-circle-fill mr-1 text-sm"></i> æ–°å¢å…§å®¹
                                </button>
                            </h4>
                            
                            <ul class="space-y-3 text-sm max-h-60 overflow-y-auto p-1">
                                <li v-for="(item, itemIndex) in course.learningContent" :key="item.id" class="p-3 bg-stone-50 rounded-lg border border-stone-200">
                                    <div class="flex justify-between items-start">
                                        <div class="text-stone-800">
                                            <span class="font-bold mr-2">{{ item.id }}:</span>
                                            <span v-if="!item.isEditing">{{ item.name }}</span>
                                            <input v-else type="text" v-model="item.name"
                                                   @keyup.enter="editLearningContent(course.id, item.id, item.name)"
                                                   class="p-1 border rounded-md focus:ring-amber-400 focus:border-amber-400 w-full text-sm">
                                        </div>
                                        
                                        <div class="flex space-x-2 text-stone-500 flex-shrink-0">
                                            <button @click.stop="item.isEditing = !item.isEditing" 
                                                    :class="['p-1 rounded-full', item.isEditing ? 'bg-green-100 text-green-600' : 'hover:bg-stone-100']">
                                                <i :class="['ph text-lg', item.isEditing ? 'ph-check' : 'ph-pencil-simple']"></i>
                                            </button>
                                            <button @click.stop="deleteLearningContent(course.id, item.id)"
                                                    class="p-1 rounded-full hover:bg-red-100 text-red-500">
                                                <i class="ph ph-trash-simple text-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                </div>

            <div v-show="activeTab === 'drafts'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“ å…§å®¹è‰ç¨¿ (è¼¸å‡ºä¸­å¿ƒ)</h2>
                <div v-if="drafts.length" class="space-y-4">
                    <div v-for="draft in drafts" :key="draft.id"
                         class="p-4 bg-white rounded-xl shadow-md border-l-4 border-green-500">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-lg text-stone-800">{{ draft.title }}</h3>
                            <span class="text-xs text-stone-500">{{ formatDate(draft.date, 'MM/DD') }}</span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">
                            <span class="font-medium text-green-700">[{{ getCourseName(draft.courseId) }}]</span>
                        </p>
                        <p class="text-sm text-stone-500 line-clamp-2">{{ draft.content }}</p>
                        <button class="mt-2 text-xs text-amber-600 hover:underline">ç·¨è¼¯/æŸ¥çœ‹å…¨æ–‡</button>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-file-text-fill text-3xl mb-2"></i>
                    <p>å°šæœªå»ºç«‹ä»»ä½•è‰ç¨¿æˆ–å¿ƒå¾—ã€‚</p>
                </div>
            </div>

            <div v-show="activeTab === 'resources'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ’¡ å­¸ç¿’è³‡æº (è¼¸å…¥ä¸­å¿ƒ)</h2>
                <div v-if="resources.length" class="space-y-4">
                    <div v-for="resource in resources" :key="resource.id"
                         class="p-4 bg-white rounded-xl shadow-md border-l-4 border-blue-500">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-lg text-stone-800">{{ resource.name }}</h3>
                            <i :class="['ph text-2xl', getResourceIcon(resource.category), 'text-blue-600']"></i>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">
                            <span class="font-medium text-blue-700">[{{ getCourseName(resource.courseId) }}]</span> -
                            <span class="text-xs text-stone-500">{{ resource.category }}</span>
                        </p>
                        <a :href="resource.url" target="_blank" class="mt-2 text-sm text-amber-600 hover:underline flex items-center">
                            æŸ¥çœ‹é€£çµ/è·¯å¾‘ <i class="ph ph-arrow-square-out ml-1"></i>
                        </a>
                        <p v-if="resource.notes" class="text-xs text-stone-400 mt-1 line-clamp-1">å‚™è¨»: {{ resource.notes }}</p>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-books text-3xl mb-2"></i>
                    <p>å°šæœªæ·»åŠ ä»»ä½•å­¸ç¿’è³‡æºã€‚</p>
                </div>
            </div>
            
        </main>

        <button @click="openModal('NewTask')"
                class="fixed bottom-24 right-6 w-14 h-14 bg-amber-500 hover:bg-amber-600 text-white rounded-full flex items-center justify-center text-3xl shadow-xl transition transform hover:scale-110 z-40">
            <i class="ph ph-plus"></i>
        </button>

        <nav class="bottom-nav fixed bottom-0 left-0 right-0 max-w-xl mx-auto bg-white border-t border-stone-100 flex justify-around items-center h-20 z-30">
            <div v-for="tab in tabs" :key="tab.id"
                 @click="activeTab = tab.id"
                 :class="['flex flex-col items-center p-2 transition cursor-pointer',
                           activeTab === tab.id ? 'text-amber-500 font-bold' : 'text-stone-500 hover:text-stone-700']">
                <i :class="['ph text-2xl', tab.icon]"></i>
                <span class="text-xs mt-1">{{ tab.name }}</span>
            </div>
        </nav>

        <div v-if="modal.isVisible" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl w-full max-w-md p-6 relative">
                <h3 class="text-xl font-bold mb-4 text-stone-800">
                    {{ modal.mode === 'NewTask' ? 'æ–°å¢æ¯æ—¥ä»»å‹™' : (modal.mode === 'NewLearningContent' ? `æ–°å¢èª²ç¨‹ ${modal.data.courseId} å­¸ç¿’å…§å®¹` : 'ç·¨è¼¯å…§å®¹') }}
                </h3>

                <div v-if="modal.mode === 'NewTask'" class="space-y-3">
                    <input type="text" placeholder="ä»»å‹™å…§å®¹ (e.g., é–±è®€ Chapter 5)"
                           v-model="newTask.content"
                           class="w-full p-3 rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400">
                    <select v-model="newTask.courseId"
                            class="w-full p-3 rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400">
                        <option :value="null">é¸æ“‡æ‰€å±¬èª²ç¨‹</option>
                        <option v-for="course in courses" :value="course.id" :key="course.id">{{ course.name }}</option>
                    </select>
                    <input type="number" placeholder="é è¨ˆæ™‚é–“ (åˆ†é˜)"
                           v-model.number="newTask.estimatedTime"
                           class="w-full p-3 rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400">
                </div>

                <div v-else-if="modal.mode === 'NewLearningContent'" class="space-y-3">
                    <input type="text" placeholder="å­¸ç¿’å…§å®¹åç¨± (e.g., è®€ã€ŠThe Mountain Is Youã€‹)"
                           v-model="newLearningContent.name"
                           class="w-full p-3 rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400">
                    <input type="text" placeholder="å…§å®¹ä»£è™Ÿ (e.g., A, B, C...)"
                           v-model="newLearningContent.id"
                           maxlength="1"
                           class="w-full p-3 rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400 uppercase">
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="closeModal" class="px-4 py-2 text-stone-600 rounded-lg hover:bg-stone-100 transition">
                        å–æ¶ˆ
                    </button>
                    <button @click="saveNewModalData" class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition">
                        å„²å­˜
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        window.vueApp = new Vue({
            el: '#app',
            data: {
                isAuthReady: false,
                userId: null,
                activeTab: 'daily',
                currentDate: new Date(),
                selectedCourseFilter: 'All',
                detailCourse: null, // ç”¨æ–¼åœ¨ overview é å…§è¯é¡¯ç¤ºè©³æƒ…
                
                tabs: [
                    { id: 'daily', name: 'æ¯æ—¥èª²è¡¨', icon: 'ph-calendar-blank-fill' },
                    { id: 'overview', name: 'èª²ç¨‹ç¸½è¦½', icon: 'ph-books-fill' },
                    { id: 'drafts', name: 'å…§å®¹è‰ç¨¿', icon: 'ph-file-text-fill' },
                    { id: 'resources', name: 'å­¸ç¿’è³‡æº', icon: 'ph-lightbulb-fill' },
                ],
                
                // ğŸš€ å„ªåŒ– 2: å…¨é¢æ›´æ–°èª²ç¨‹è³‡æ–™ (åŒ…å« A-R å­¸ç¿’å…§å®¹)
                courses: [
                    { 
                        id: 1, name: 'å¿ƒç†æˆé•·èˆ‡è‡ªä¿¡é›éŠ', goal: 'é™ä½ç„¦æ…®ä¸¦å»ºç«‹è‡ªä¿¡', outcome: 'å®Œæˆä¸€æœ¬æ›¸ï¼‹å½¢æˆç©©å®šå¿ƒç†ç·´ç¿’', totalTasks: 18, completedCount: 12, actualTime: 5.5, 
                        learningContent: [
                            { id: 'A', name: 'è®€ã€ŠThe Mountain Is Youã€‹ï¼ˆ10â€“15 åˆ†é˜ï¼‰', isEditing: false }, 
                            { id: 'B', name: 'è½å¿ƒç†ï¼æˆé•· podcastï¼ˆ10 åˆ†é˜ï¼‰', isEditing: false },
                            { id: 'C', name: 'å¯¦ä½œï¼š2 ä»¶åšå¾—å¥½ã€ç„¦æ…®ä¸‰å•ã€30 ç§’è‡ªæˆ‘è‚¯å®šéŒ„éŸ³', isEditing: false }
                        ] 
                    },
                    { 
                        id: 2, name: 'Finance AI Insight å°ˆæ¥­åŠ›', goal: 'å¼·åŒ–è²¡æœƒåŸºç¤èˆ‡æ•¸æ“šæ´å¯Ÿèƒ½åŠ›', outcome: 'å®Œæˆä¸­æœƒé€²åº¦ï¼‹å»ºç«‹å¯å±•ç¤ºçš„ BI/AI ä½œå“', totalTasks: 25, completedCount: 5, actualTime: 1.2, 
                        learningContent: [
                            { id: 'D', name: 'è®€ä¸­æœƒæ•™æ 1 å°ç¯€ï¼ˆ10â€“15 åˆ†é˜ï¼‰', isEditing: false }, 
                            { id: 'E', name: 'è®€ Finance Insight æ›¸ç±ï¼ˆ10 åˆ†é˜ï¼‰', isEditing: false },
                            { id: 'F', name: 'Power BIï¼AI å¯¦ä½œï¼ˆDAXã€å°è‡ªå‹•åŒ–ã€æ•¸æ“šæ‘˜è¦ï¼‰', isEditing: false }
                        ] 
                    },
                    { 
                        id: 3, name: 'å€‹äººè²¡å‹™èˆ‡é–‹æºè²·æˆ¿ç­–ç•¥', goal: 'å»ºç«‹é–‹æºè·¯ç·šèˆ‡ä¸‰å¹´è²·æˆ¿è¨ˆç•«', outcome: 'å®Œæˆè²·æˆ¿è©¦ç®—ï¼‹å½¢æˆé–‹æºæ–¹å‘', totalTasks: 15, completedCount: 8, actualTime: 3.0, 
                        learningContent: [
                            { id: 'G', name: 'é–‹æºç·´ç¿’ï¼ˆåƒ¹å€¼æ¸…å–®ã€Hard Data è‰ç¨¿ï¼‰', isEditing: false }, 
                            { id: 'H', name: 'è²·æˆ¿è¡Œå‹•ï¼ˆå„²è“„ç‡ã€é ­æœŸé‡‘è©¦ç®—ã€æˆ¿è²¸åè©ï¼‰', isEditing: false },
                            { id: 'I', name: 'æŠ•è³‡ç¶­æŒï¼ˆæ–‡ç«  1 ç¯‡ã€éƒ¨ä½æª¢æŸ¥ï¼‰', isEditing: false }
                        ] 
                    },
                    { 
                        id: 4, name: 'è‹±èªè¡¨é”èˆ‡åœ‹éš›æºé€š', goal: 'æå‡è‹±æ–‡å£èªªèˆ‡æœƒè­°è¡¨é”', outcome: 'ç´¯ç©éŒ„éŸ³èˆ‡æ—¥å¸¸è‹±æ–‡è¼¸å‡º', totalTasks: 30, completedCount: 20, actualTime: 7.0, 
                        learningContent: [
                            { id: 'J', name: 'çœ‹è‹±æ–‡ vlogï¼ˆ10 åˆ†é˜ï¼‰', isEditing: false }, 
                            { id: 'K', name: 'å£èªªç·´ç¿’ï¼ˆ30 ç§’å³å¸­ã€AT å¾©è¿°ã€1 åˆ†é˜ insightï¼‰', isEditing: false },
                            { id: 'L', name: 'å¯« 5 å¥å¤–å•†è‹±æ–‡ï¼ˆå¯é¸ï¼‰', isEditing: false }
                        ] 
                    },
                    { 
                        id: 5, name: 'å€‹äººå“ç‰Œèˆ‡å‰¯æ¥­å…§å®¹å‰µä½œ', goal: 'æ‰“é€ å¤–å•†ï¼‹AIï¼‹æˆé•·çš„çŸ¥è­˜å‹å…§å®¹', outcome: 'æ¯é€±ç´¯ç© 1â€“2 ç¯‡è‰ç¨¿', totalTasks: 12, completedCount: 4, actualTime: 2.1, 
                        learningContent: [
                            { id: 'M', name: 'å¤–å•†ä¸»é¡Œå…§å®¹ï¼ˆå¿ƒå¾—ã€è¡“èªã€æµç¨‹ï¼‰', isEditing: false }, 
                            { id: 'N', name: 'AI ä¸»é¡Œå…§å®¹ï¼ˆæµç¨‹æ•´ç†ã€prompt æ¨¡æ¿ï¼‰', isEditing: false },
                            { id: 'O', name: 'æˆé•·å…§å®¹ï¼ˆå¿ƒå¾—ã€åæ€ï¼‰', isEditing: false }
                        ] 
                    },
                    { 
                        id: 6, name: 'ç”Ÿæ´»éˆæ„Ÿèˆ‡ç¾æ„Ÿæ¢ç´¢', goal: 'å¢å¼·ç”Ÿæ´»èƒ½é‡èˆ‡éˆæ„Ÿ', outcome: 'å½¢æˆå¯è½‰åŒ–ç‚ºå…§å®¹çš„éˆæ„Ÿåº«', totalTasks: 10, completedCount: 10, actualTime: 4.8, 
                        learningContent: [
                            { id: 'P', name: 'æ¯æœˆ 1 æ¬¡é«”é©—ï¼ˆå±•è¦½ï¼è¬›åº§ï¼æ›¸åº— etc.ï¼‰', isEditing: false }, 
                            { id: 'Q', name: 'æ¯é€± 3 å€‹éˆæ„Ÿç´€éŒ„', isEditing: false },
                            { id: 'R', name: 'ç”Ÿæ´»å¿ƒå¾—ï¼ˆå¯é¸ï¼‰', isEditing: false }
                        ] 
                    },
                ],
                tasks: [], 
                drafts: [], 
                resources: [], 
                
                // Modal ç›¸é—œæ•¸æ“š
                modal: {
                    isVisible: false,
                    mode: 'NewTask',
                    data: {}
                },
                newTask: { // ç”¨æ–¼æ–°å¢ä»»å‹™
                    content: '',
                    courseId: null,
                    estimatedTime: null
                },
                newLearningContent: { // ç”¨æ–¼æ–°å¢ A-R é …ç›®
                    id: '', // e.g. 'A'
                    name: ''
                }
            },
            computed: {
                dateRange() {
                    const days = [];
                    const today = this.formatDate(new Date(), 'YYYY-MM-DD');
                    for (let i = -3; i <= 3; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() + i);
                        const dateString = this.formatDate(date, 'YYYY-MM-DD');
                        days.push({
                            date: date,
                            dateString: dateString, 
                            dayOfWeek: ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][date.getDay()],
                            dayOfMonth: date.getDate(),
                            isToday: dateString === today,
                            isSelected: this.formatDate(this.currentDate, 'YYYY-MM-DD') === dateString
                        });
                    }
                    return days;
                },
                filteredTasks() {
                    const selectedDate = this.formatDate(this.currentDate, 'YYYY-MM-DD');
                    // æ³¨æ„ï¼šVue æ¨¡æ¿ä¸­çš„ task.courseId å¯èƒ½æ˜¯æ•¸å­—æˆ–å­—ç¬¦ä¸²ï¼Œé€™è£¡ç”¨ === éœ€ç¢ºä¿é¡å‹ä¸€è‡´æ€§
                    return this.tasks
                        .filter(task => this.formatDate(task.date, 'YYYY-MM-DD') === selectedDate)
                        .filter(task => this.selectedCourseFilter === 'All' || task.courseId === parseInt(this.selectedCourseFilter));
                },
                totalActualTime() {
                    return (this.courses.reduce((sum, c) => sum + c.actualTime, 0)).toFixed(1);
                },
                courseProgress() {
                    const progress = {};
                    this.courses.forEach(course => {
                        if (course.totalTasks === 0) {
                            progress[course.id] = 0;
                        } else {
                            progress[course.id] = Math.floor((course.completedCount / course.totalTasks) * 100);
                        }
                    });
                    return progress;
                },
            },
            watch: {
                isAuthReady(isReady) {
                    if (isReady && this.userId) {
                        this.fetchData('tasks');
                        this.fetchData('drafts');
                        this.fetchData('resources');
                    }
                }
            },
            methods: {
                formatDate(date, format) {
                    if (!date) return '';
                    const d = date instanceof Date ? date : (date.toDate ? date.toDate() : new Date(date));

                    const pad = (n) => (n < 10 ? '0' + n : n);
                    let str = format;
                    str = str.replace('YYYY', d.getFullYear());
                    str = str.replace('MM', pad(d.getMonth() + 1));
                    str = str.replace('DD', pad(d.getDate()));
                    str = str.replace('HH', pad(d.getHours()));
                    str = str.replace('mm', pad(d.getMinutes()));
                    return str;
                },
                selectDate(date) {
                    this.currentDate = date;
                },
                getResourceIcon(category) {
                    const icons = {
                        'æ›¸ç±/æ•™æ': 'ph-book-open-text',
                        'Podcast/Vlog é€£çµ': 'ph-monitor-play',
                        'å·¥å…·ç¶²ç«™/è»Ÿé«”': 'ph-code',
                        'æ–‡ä»¶/æª”æ¡ˆè·¯å¾‘': 'ph-folder-simple-fill',
                        'é«”é©—æ´»å‹• P': 'ph-leaf-light'
                    };
                    return icons[category] || 'ph-link';
                },
                // ğŸš€ å„ªåŒ– 1 è¼”åŠ©å‡½æ•¸: æ ¹æ“š ID ç²å–å®Œæ•´èª²ç¨‹åç¨±
                getCourseName(courseId) {
                    const course = this.courses.find(c => c.id === courseId);
                    return course ? `${course.name} (èª²ç¨‹ ${course.id})` : `èª²ç¨‹ ${courseId}`;
                },
                openModal(mode, data = {}) {
                    this.modal.mode = mode;
                    this.modal.data = data;
                    if (mode === 'NewTask') {
                        this.newTask = { content: '', courseId: null, estimatedTime: null };
                    } else if (mode === 'NewLearningContent') {
                         this.newLearningContent = { id: '', name: '' };
                    }
                    this.modal.isVisible = true;
                },
                closeModal() {
                    this.modal.isVisible = false;
                    this.modal.data = {};
                },
                // è™•ç† Modal å„²å­˜å‹•ä½œ (ä»»å‹™/å­¸ç¿’å…§å®¹)
                saveNewModalData() {
                    if (this.modal.mode === 'NewTask') {
                        this.saveNewTask();
                    } else if (this.modal.mode === 'NewLearningContent') {
                        this.saveNewLearningContent(this.modal.data.courseId);
                    }
                },
                // æ–°å¢æ¯æ—¥ä»»å‹™ (æ¨¡æ“¬)
                saveNewTask() {
                     if (!this.newTask.content || !this.newTask.courseId || !this.newTask.estimatedTime) {
                        alert('è«‹å¡«å¯«æ‰€æœ‰ä»»å‹™æ¬„ä½ï¼');
                        return;
                    }

                    // æ¨¡æ“¬ Local å„²å­˜
                    const newTaskData = {
                        id: `t${Date.now()}`,
                        date: this.currentDate,
                        courseId: parseInt(this.newTask.courseId),
                        content: this.newTask.content,
                        estimatedTime: this.newTask.estimatedTime,
                        actualTime: 0,
                        completed: false
                    };
                    this.tasks.push(newTaskData);
                    alert('ä»»å‹™æ–°å¢æˆåŠŸï¼');
                    this.closeModal();
                },
                // ğŸš€ å„ªåŒ– 3: ç·¨è¼¯ A-R å­¸ç¿’å…§å®¹ (æ¨¡æ“¬)
                editLearningContent(courseId, contentId, newName) {
                    const course = this.courses.find(c => c.id === courseId);
                    if (course) {
                        const content = course.learningContent.find(lc => lc.id === contentId);
                        if (content) {
                            content.name = newName;
                            content.isEditing = false;
                            alert(`${contentId} å…§å®¹å·²æ›´æ–°ï¼`);
                            // é€™è£¡å¯ä»¥åŠ å…¥ Firebase çš„å„²å­˜é‚è¼¯
                        }
                    }
                },
                // ğŸš€ å„ªåŒ– 3: åˆªé™¤ A-R å­¸ç¿’å…§å®¹ (æ¨¡æ“¬)
                deleteLearningContent(courseId, contentId) {
                    if (!confirm(`ç¢ºå®šè¦å¾èª²ç¨‹ä¸­åˆªé™¤ä»£è™Ÿ ${contentId} çš„å­¸ç¿’å…§å®¹å—ï¼Ÿ`)) return;

                    const courseIndex = this.courses.findIndex(c => c.id === courseId);
                    if (courseIndex !== -1) {
                        const course = this.courses[courseIndex];
                        const initialLength = course.learningContent.length;
                        
                        // éæ¿¾æ‰è¦åˆªé™¤çš„å…§å®¹
                        course.learningContent = course.learningContent.filter(lc => lc.id !== contentId);

                        if (course.learningContent.length < initialLength) {
                            alert(`${contentId} å­¸ç¿’å…§å®¹å·²åˆªé™¤ã€‚`);
                            // é€™è£¡å¯ä»¥åŠ å…¥ Firebase çš„åˆªé™¤é‚è¼¯
                        }
                    }
                },
                // æ–°å¢ A-R å­¸ç¿’å…§å®¹ (æ¨¡æ“¬)
                saveNewLearningContent(courseId) {
                    if (!this.newLearningContent.id || !this.newLearningContent.name) {
                        alert('è«‹å¡«å¯«å…§å®¹ä»£è™Ÿå’Œåç¨±ï¼');
                        return;
                    }
                    const course = this.courses.find(c => c.id === courseId);
                    const newId = this.newLearningContent.id.toUpperCase();

                    if (course.learningContent.some(lc => lc.id === newId)) {
                        alert(`ä»£è™Ÿ ${newId} å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨å…¶ä»–ä»£è™Ÿã€‚`);
                        return;
                    }

                    course.learningContent.push({
                        id: newId,
                        name: this.newLearningContent.name,
                        isEditing: false
                    });
                    
                    // æ ¹æ“šä»£è™Ÿæ’åº (ç°¡å–®çš„å­—æ¯æ’åº)
                    course.learningContent.sort((a, b) => a.id.localeCompare(b.id));

                    alert('æ–°çš„å­¸ç¿’å…§å®¹å·²æ–°å¢ï¼');
                    this.closeModal();
                },
                // Firestore æ•¸æ“šè¼‰å…¥èˆ‡å¯¦æ™‚ç›£è½ (ä¿æŒä¸è®Š)
                fetchData(collectionName) {
                    if (!window.dbFunctions || !this.userId) return;

                    const { collection, query, onSnapshot } = window.dbFunctions;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const dataPath = `/artifacts/${appId}/users/${this.userId}/${collectionName}`;

                    console.log(`æ­£åœ¨ç›£è½: ${dataPath}`);

                    const q = query(collection(window.db, dataPath));

                    onSnapshot(q, (snapshot) => {
                        const items = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            if (data.date && data.date.toDate) data.date = data.date.toDate();
                            if (data.completedAt && data.completedAt.toDate) data.completedAt = data.completedAt.toDate();
                            items.push({ id: doc.id, ...data });
                        });

                        if (collectionName === 'tasks') this.tasks = items;
                        if (collectionName === 'drafts') this.drafts = items.sort((a, b) => b.date - a.date);
                        if (collectionName === 'resources') this.resources = items;

                        console.log(`å·²è¼‰å…¥ ${items.length} ç­† ${collectionName} è³‡æ–™`);
                    }, (error) => {
                        console.error(`ç›£è½ ${collectionName} å¤±æ•—:`, error);
                    });
                },
                // æ¨¡æ“¬åˆ‡æ›ä»»å‹™å®Œæˆç‹€æ…‹ (ä¿æŒä¸è®Š)
                async toggleTaskCompletion(taskId, isCompleted) {
                    if (!window.dbFunctions || !this.userId) {
                         const task = this.tasks.find(t => t.id === taskId);
                         if (task) {
                            task.completed = isCompleted;
                            task.completedAt = isCompleted ? new Date() : null;
                            task.actualTime = isCompleted ? (Math.random() * 30 + 10).toFixed(0) : 0; // æ¨¡æ“¬éš¨æ©Ÿè€—æ™‚
                         }
                         return;
                    }

                    const taskRef = window.dbFunctions.doc(window.db, `/artifacts/${__app_id}/users/${this.userId}/tasks`, taskId);
                    const updateData = {
                        completed: isCompleted,
                        completedAt: isCompleted ? window.dbFunctions.serverTimestamp() : null,
                        actualTime: isCompleted ? (Math.random() * 30 + 10).toFixed(0) : 0 
                    };

                    try {
                        await window.dbFunctions.updateDoc(taskRef, updateData);
                        console.log("ä»»å‹™ç‹€æ…‹æ›´æ–°æˆåŠŸ:", taskId);
                    } catch (error) {
                        console.error("æ›´æ–°ä»»å‹™ç‹€æ…‹å¤±æ•—:", error);
                    }
                },
            },
            created() {
                // è¼‰å…¥æ¨¡æ“¬æ•¸æ“š (åƒ…åœ¨ç„¡ Firebase ç’°å¢ƒä¸‹åŸ·è¡Œ)
                if (!window.firebaseApp) {
                    this.tasks = [
                        { id: 't1', date: new Date(), courseId: 1, content: 'è®€ã€ŠThe Mountain Is Youã€‹', estimatedTime: 15, actualTime: 12, completed: true, completedAt: new Date(new Date().setHours(8, 0, 0)) },
                        { id: 't2', date: new Date(), courseId: 2, content: 'æ’°å¯« AI å ±å‘Šè‰ç¨¿', estimatedTime: 60, actualTime: 0, completed: false },
                        { id: 't3', date: new Date(), courseId: 6, content: 'è¨˜éŒ„ç”Ÿæ´»éˆæ„Ÿ P', estimatedTime: 30, actualTime: 0, completed: false },
                        { id: 't4', date: new Date(new Date().setDate(new Date().getDate() + 1)), courseId: 3, content: 'å»ºç«‹ Q3 è²¡å‹™æ¨¡å‹', estimatedTime: 90, actualTime: 0, completed: false },
                        { id: 't5', date: new Date(new Date().setDate(new Date().getDate() - 2)), courseId: 4, content: 'ç·´ç¿’ä¸»é¡Œ M ç°¡å ±', estimatedTime: 45, actualTime: 30, completed: true, completedAt: new Date(new Date().setHours(14, 30, 0)) },
                    ];
                    this.drafts = [
                        { id: 'd1', date: new Date(), courseId: 1, title: 'ç„¦æ…®ä¸‰å•åæ€', content: 'ä»Šå¤©é€éä¸‰å•æ³•ï¼Œæˆ‘ç™¼ç¾ç„¦æ…®çš„æ ¹æºåœ¨æ–¼å°æœªä¾†æ§åˆ¶æ„Ÿçš„ç¼ºä¹...' },
                        { id: 'd2', date: new Date(new Date().setDate(new Date().getDate() - 1)), courseId: 5, title: 'å…§å®¹ä¸»é¡Œ Q ç™¼æƒ³', content: 'æˆ‘æ±ºå®šä»¥ã€ŒçŸ¥è­˜ç„¦æ…®ã€ç‚ºé¡Œï¼Œå¾å…©å€‹è§’åº¦åˆ‡å…¥ï¼Œç¬¬ä¸€æ˜¯è¼¸å…¥éå¤šï¼Œç¬¬äºŒæ˜¯æ²’æœ‰è¼¸å‡º...' },
                    ];
                    this.resources = [
                        { id: 'r1', courseId: 1, name: 'Atomic Habits', category: 'æ›¸ç±/æ•™æ', url: '#', notes: 'é—œæ–¼åŸå­ç¿’æ…£çš„å»ºç«‹' },
                        { id: 'r2', courseId: 4, name: 'å¤–å•†ä¸»é¡Œ M ç¯„æœ¬', category: 'æ–‡ä»¶/æª”æ¡ˆè·¯å¾‘', url: '#', notes: 'é‡è¦ç°¡å ±ç¯„ä¾‹' },
                    ];
                }
            }
        });
    </script>
</body>
</html>