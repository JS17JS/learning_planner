<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººæˆé•·å­¸ç¿’è»Œè·¡ App - æ—¥ç³»æ¥µç°¡é¢¨</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <!-- Phosphor Icons (for App icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* æ—¥ç³»æ¥µç°¡é¢¨å­—é«”ï¼šä½¿ç”¨ç³»çµ±é è¨­çš„ç„¡è¥¯ç·šå­—é«”ï¼Œç¢ºä¿æ¸…æ™°åº¦ */
        body {
            font-family: 'Inter', 'Noto Sans TC', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #fcfbf8; /* æ•´é«”èƒŒæ™¯ï¼šç±³ç™½è‰²èª¿å»¶ä¼¸ */
        }
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ (åƒ…é©ç”¨æ–¼æ¡Œé¢) */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #d7b57a; border-radius: 2px; }
        ::-webkit-scrollbar-track { background: #fcfbf8; }

        /* é é¦–åœ“å¼§éŠœæ¥æ•ˆæœ */
        .header-curve-mask {
            /* æ¨¡æ“¬åœ“å¼§æ•ˆæœï¼šä½¿ç”¨è²  margin å’Œ padding å°‡ä¸‹æ–¹å…§å®¹æ‹‰ä¸Šä¾† */
            position: relative;
            z-index: 10;
            margin-top: -50px; /* å‘ä¸Šæ‹‰å‹•é‡ç–Š */
            padding-top: 50px;
            border-top-left-radius: 40px;
            border-top-right-radius: 40px;
            background-color: #ffffff; /* ä¸»å…§å®¹å€å¡Šçš„ç™½åº• */
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05); /* è¼•å¾®é™°å½±è®“éŠœæ¥æ›´è‡ªç„¶ */
        }

        /* åº•éƒ¨å°èˆªæ¬„ */
        .bottom-nav {
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
        }
    </style>
    <!-- Firebase/Firestore CDNs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables (Canvas environment provides these)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (Object.keys(firebaseConfig).length > 0) {
            window.firebaseApp = initializeApp(firebaseConfig);
            window.db = getFirestore(window.firebaseApp);
            window.auth = getAuth(window.firebaseApp);

            // ç¢ºä¿æ‰€æœ‰ Firestore æ“ä½œéƒ½åœ¨èªè­‰å®Œæˆå¾ŒåŸ·è¡Œ
            onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    console.log("Firebase èªè­‰æˆåŠŸï¼Œä½¿ç”¨è€… ID:", user.uid);
                    window.vueApp.userId = user.uid;
                } else if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(window.auth, initialAuthToken);
                    } catch (error) {
                        console.error("Custom token ç™»å…¥å¤±æ•—:", error);
                        await signInAnonymously(window.auth);
                    }
                } else {
                    await signInAnonymously(window.auth);
                }
                window.vueApp.isAuthReady = true;
            });

            // å°‡ Firestore å‡½æ•¸æš´éœ²çµ¦ Vue å¯¦ä¾‹
            window.dbFunctions = {
                doc, collection, query, where, onSnapshot, addDoc, setDoc, updateDoc, deleteDoc, serverTimestamp
            };
        } else {
            console.error("Firebase é…ç½®æœªè¼‰å…¥ã€‚App å°‡ä»¥æ¨¡æ“¬æ¨¡å¼é‹è¡Œ (ç„¡æ³•æŒä¹…å„²å­˜è³‡æ–™)ã€‚");
            window.vueApp.isAuthReady = true;
        }
    </script>
</head>
<body class="antialiased min-h-screen">
    <div id="app" class="max-w-xl mx-auto min-h-screen bg-stone-50 pb-20"> <!-- é™åˆ¶æœ€å¤§å¯¬åº¦ä»¥æ¨¡æ“¬æ‰‹æ©Ÿ App -->

        <!-- A. é é¦– Banner å€å¡Š -->
        <header class="h-[250px] relative overflow-hidden bg-amber-100">
            <!-- åœ–ç‰‡å®¹å™¨: Banner (ä¿®æ­£ placeholder äº‚ç¢¼å•é¡Œï¼Œä½¿ç”¨è‹±æ–‡æ–‡å­—) -->
            <img src="https://placehold.co/1920x400/fff3e0/333?text=Growth+Tracker+App+Banner"
                 alt="App Banner"
                 class="absolute inset-0 w-full h-full object-cover opacity-80"
                 onerror="this.onerror=null;this.src='https://placehold.co/1920x400/fff3e0/333?text=Growth+Tracker+App+Banner'">

            <!-- App åç¨±/Logo -->
            <div class="absolute top-0 left-0 right-0 p-4 text-white text-center font-bold text-2xl z-20">
                ğŸš€ å€‹äººæˆé•·è»Œè·¡
            </div>

            <!-- é é¦–èˆ‡ç™½åº•åœ“å¼§éŠœæ¥ -->
            <div class="absolute bottom-0 left-0 right-0 h-16 bg-stone-50"
                 style="border-top-left-radius: 40px; border-top-right-radius: 40px; transform: translateY(40px);">
            </div>
        </header>

        <!-- B. ä¸»å…§å®¹å€ (ä½¿ç”¨è² é‚Šè·å‘ä¸Šæ‹‰å‹•é‡ç–Š) -->
        <main class="p-4 relative bg-white header-curve-mask min-h-[calc(100vh-250px)]">

            <!-- 1. ğŸ“… æ¯æ—¥èª²è¡¨ (ä¸»é /Dashboard) -->
            <div v-show="activeTab === 'daily'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“… {{ formatDate(currentDate, 'MMæœˆDDæ—¥') }} èª²è¡¨</h2>

                <!-- (1) æ—¥æœŸé¸å–® (Date Selector) -->
                <div class="flex space-x-2 overflow-x-auto pb-4 sticky top-0 bg-white z-20 shadow-sm border-b">
                    <!-- FIX: ä½¿ç”¨ day.dateString ä½œç‚º key -->
                    <div v-for="day in dateRange" :key="day.dateString"
                         @click="selectDate(day.date)"
                         :class="['flex-shrink-0 w-16 h-16 rounded-xl p-1 text-center cursor-pointer transition',
                                   day.isToday ? 'bg-amber-100 shadow-md border-2 border-amber-300' : 'bg-stone-50',
                                   day.isSelected ? 'bg-amber-400 text-white font-bold transform scale-105' : 'text-stone-700']">
                        <div class="text-xs opacity-70">{{ day.dayOfWeek }}</div>
                        <div class="text-2xl leading-none font-bold">{{ day.dayOfMonth }}</div>
                    </div>
                </div>

                <!-- (2) èª²ç¨‹ç¯©é¸ (Filter) -->
                <div class="my-4">
                    <select v-model="selectedCourseFilter"
                            class="w-full p-3 rounded-xl border border-stone-200 bg-stone-50 text-stone-700 text-sm focus:ring-amber-400 focus:border-amber-400">
                        <option value="All">æ‰€æœ‰ä»»å‹™</option>
                        <option v-for="course in courses" :value="course.id" :key="course.id">
                            {{ course.name }}
                        </option>
                    </select>
                </div>

                <!-- (3) ä»»å‹™å¡ç‰‡ (Task Card) -->
                <div v-if="filteredTasks.length" class="space-y-3">
                    <div v-for="(task, index) in filteredTasks" :key="task.id"
                         :class="['p-4 rounded-xl shadow-md border-l-4 transition duration-300',
                                   task.completed ? 'bg-stone-100 border-green-400 opacity-70' : 'bg-white border-amber-400']">
                        <!-- æ‹–æ›³æç¤º (Drag & Drop placeholder) -->
                        <div class="flex items-center justify-between mb-2 text-stone-400 text-xs">
                            <span>èª²ç¨‹ {{ task.courseId }}</span>
                            <i class="ph ph-dots-three-vertical cursor-grab"></i>
                        </div>

                        <div class="flex items-center justify-between">
                            <div :class="['flex-1 mr-4', task.completed ? 'line-through text-stone-500' : 'text-stone-800']">
                                <p class="font-semibold text-lg">{{ task.content }}</p>
                            </div>

                            <div class="flex items-center space-x-3">
                                <!-- é è¨ˆåŸ·è¡Œæ™‚é–“ -->
                                <span class="text-sm text-amber-600 font-medium flex-shrink-0">
                                    {{ task.estimatedTime }} åˆ†é˜
                                </span>
                                <!-- å®Œæˆç‹€æ…‹ (Checkbox) -->
                                <input type="checkbox" :checked="task.completed"
                                       @change="toggleTaskCompletion(task.id, $event.target.checked)"
                                       class="h-6 w-6 text-green-600 rounded border-stone-300 focus:ring-green-500 cursor-pointer flex-shrink-0">
                            </div>
                        </div>

                        <!-- è¨ˆæ™‚èˆ‡äº’å‹•å…ƒç´  -->
                        <div class="mt-3 border-t pt-3 flex justify-between items-center text-sm">
                            <span v-if="task.completed" class="text-xs text-green-600 font-medium">
                                å®Œæˆæ–¼: {{ formatDate(task.completedAt, 'HH:mm') }}
                            </span>
                            <button v-else
                                    class="px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white text-xs font-semibold rounded-full transition shadow-md">
                                <i class="ph ph-play-fill mr-1"></i> é–‹å§‹è¨ˆæ™‚ (Timer Placeholder)
                            </button>
                            <span class="text-xs text-stone-500">
                                å¯¦éš›è€—æ™‚: {{ task.actualTime || '0' }} åˆ†é˜
                            </span>
                        </div>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-calendar-blank text-3xl mb-2"></i>
                    <p>æœ¬æ—¥ç„¡æ’ç¨‹ä»»å‹™ï¼Œé»æ“Šå³ä¸‹è§’ '+' æ–°å¢ã€‚</p>
                </div>

                <!-- (5) æ¯æ—¥å›é¡§å€ -->
                <div class="mt-8">
                    <details class="rounded-xl bg-stone-50 p-4 border border-stone-200">
                        <summary class="font-semibold text-stone-700 cursor-pointer">
                            ğŸ“ ä»Šæ—¥å¿ƒå¾—èˆ‡åæ€ (R) - èª²ç¨‹ 6
                        </summary>
                        <textarea rows="4" placeholder="è¼¸å…¥æ‚¨ä»Šæ—¥çš„åæ€ã€æŒ‘æˆ°æˆ–çªç ´..."
                                  class="w-full mt-3 p-3 text-sm rounded-lg border border-stone-300 focus:ring-amber-400 focus:border-amber-400"></textarea>
                        <button class="w-full mt-2 py-2 bg-stone-700 text-white rounded-lg hover:bg-stone-800 transition">
                            å„²å­˜å¿ƒå¾—
                        </button>
                    </details>
                </div>
            </div>

            <!-- 2. ğŸ“š èª²ç¨‹ç¸½è¦½ (Curriculum Overview) -->
            <div v-show="activeTab === 'overview'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“š èª²ç¨‹ç¸½è¦½</h2>

                <!-- ç¸½æ™‚é–“çµ±è¨ˆ -->
                <div class="mb-6 p-4 bg-amber-100 rounded-xl shadow-sm border border-amber-200">
                    <p class="text-sm text-stone-600 mb-1">æ‰€æœ‰èª²ç¨‹ç¸½è¨ˆå¯¦éš›åŸ·è¡Œæ™‚é–“</p>
                    <p class="text-3xl font-extrabold text-stone-800">{{ totalActualTime }} å°æ™‚</p>
                    <small class="text-xs text-stone-500">æœ¬æœˆ/æœ¬é€±ç¯©é¸åŠŸèƒ½å¾…é–‹ç™¼...</small>
                </div>

                <!-- (1) èª²ç¨‹å¡ç‰‡é¡¯ç¤º -->
                <div class="space-y-6">
                    <div v-for="course in courses" :key="course.id"
                         @click="viewCourseDetail(course.id)"
                         class="p-5 bg-white rounded-xl shadow-lg border-l-4 border-amber-500 cursor-pointer transition hover:shadow-xl hover:scale-[1.01]">
                        <h3 class="text-xl font-bold text-stone-800 mb-1">{{ course.name }} (èª²ç¨‹ {{ course.id }})</h3>
                        <p class="text-sm text-stone-600 mb-3 italic">ç›®æ¨™: {{ course.goal }}</p>

                        <!-- é€²åº¦æ¢ (Progress Bar) -->
                        <div class="w-full bg-stone-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full bg-amber-500 transition-all duration-500"
                                 :style="{ width: courseProgress[course.id] + '%' }"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-1 text-stone-500">
                            <span>å·²å®Œæˆ: {{ course.completedCount }} / {{ course.totalTasks }}</span>
                            <span class="font-bold text-amber-700">{{ courseProgress[course.id] }}%</span>
                        </div>
                    </div>
                </div>

                <!-- (2) èª²ç¨‹è©³æƒ…é  (Modal Placeholder) -->
                <!-- FIX: detailCourse å·²åœ¨ data ä¸­åˆå§‹åŒ– -->
                <div v-if="detailCourse" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl w-full max-w-md p-6 overflow-y-auto max-h-full">
                        <h3 class="text-2xl font-bold text-stone-800 mb-4">{{ detailCourse.name }} è©³æƒ…</h3>

                        <div class="mb-4">
                            <p class="text-sm text-stone-600">ç¸½ç´¯è¨ˆåŸ·è¡Œæ™‚é–“: <span class="font-bold">{{ detailCourseStats.actualTime }} å°æ™‚</span></p>
                            <p class="text-sm text-stone-600">ç¸½å®Œæˆæ¬¡æ•¸: <span class="font-bold">{{ detailCourseStats.completedCount }} æ¬¡</span></p>
                        </div>

                        <h4 class="font-semibold text-stone-700 mb-2 border-b pb-1">å­¸ç¿’å…§å®¹æ¸…å–® (å­é …ç›® A-R)</h4>
                        <ul class="space-y-2 text-sm max-h-60 overflow-y-auto p-1">
                            <!-- é€™è£¡æ‡‰å¾ Firestore ç²å–èª²ç¨‹å­é …ç›®æ¸…å–® -->
                            <li v-for="item in detailCourse.learningContent" :key="item.id" class="border-b pb-1">
                                <span class="font-medium text-stone-800">{{ item.name }}</span>
                                <p class="text-xs text-stone-500">æˆæœé€£çµ:
                                    <a href="#" class="text-amber-600 hover:underline">æŸ¥çœ‹æˆæœ ></a>
                                </p>
                            </li>
                        </ul>

                        <button @click="detailCourse = null" class="mt-6 w-full py-2 bg-stone-700 text-white rounded-lg hover:bg-stone-800 transition">
                            é—œé–‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- 3. ğŸ“ å…§å®¹è‰ç¨¿ (Content Drafts) -->
            <div v-show="activeTab === 'drafts'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ“ å…§å®¹è‰ç¨¿ (è¼¸å‡ºä¸­å¿ƒ)</h2>

                <div v-if="drafts.length" class="space-y-4">
                    <div v-for="draft in drafts" :key="draft.id"
                         class="p-4 bg-white rounded-xl shadow-md border-l-4 border-green-500">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-lg text-stone-800">{{ draft.title }}</h3>
                            <span class="text-xs text-stone-500">{{ formatDate(draft.date, 'MM/DD') }}</span>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">
                            <span class="font-medium text-green-700">[{{ courses.find(c => c.id === draft.courseId)?.name || 'æœªåˆ†é¡' }}]</span>
                        </p>
                        <p class="text-sm text-stone-500 line-clamp-2">{{ draft.content }}</p>
                        <button class="mt-2 text-xs text-amber-600 hover:underline">ç·¨è¼¯/æŸ¥çœ‹å…¨æ–‡</button>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-file-text-fill text-3xl mb-2"></i>
                    <p>å°šæœªå»ºç«‹ä»»ä½•è‰ç¨¿æˆ–å¿ƒå¾—ã€‚</p>
                </div>
            </div>

            <!-- 4. ğŸ’¡ å­¸ç¿’è³‡æº (Learning Resources) -->
            <div v-show="activeTab === 'resources'" class="pt-2">
                <h2 class="text-2xl font-bold mb-4 text-stone-800">ğŸ’¡ å­¸ç¿’è³‡æº (è¼¸å…¥ä¸­å¿ƒ)</h2>

                <div v-if="resources.length" class="space-y-4">
                    <div v-for="resource in resources" :key="resource.id"
                         class="p-4 bg-white rounded-xl shadow-md border-l-4 border-blue-500">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-lg text-stone-800">{{ resource.name }}</h3>
                            <i :class="['ph text-2xl', getResourceIcon(resource.category), 'text-blue-600']"></i>
                        </div>
                        <p class="text-sm text-stone-600 mb-2">
                            <span class="font-medium text-blue-700">[{{ courses.find(c => c.id === resource.courseId)?.name || 'æœªåˆ†é¡' }}]</span> -
                            <span class="text-xs text-stone-500">{{ resource.category }}</span>
                        </p>
                        <a :href="resource.url" target="_blank" class="mt-2 text-sm text-amber-600 hover:underline flex items-center">
                            æŸ¥çœ‹é€£çµ/è·¯å¾‘ <i class="ph ph-arrow-square-out ml-1"></i>
                        </a>
                        <p v-if="resource.notes" class="text-xs text-stone-400 mt-1 line-clamp-1">å‚™è¨»: {{ resource.notes }}</p>
                    </div>
                </div>
                <div v-else class="p-6 text-center text-stone-500 bg-stone-100 rounded-xl mt-6">
                    <i class="ph ph-books text-3xl mb-2"></i>
                    <p>å°šæœªæ·»åŠ ä»»ä½•å­¸ç¿’è³‡æºã€‚</p>
                </div>
            </div>

        </main>

        <!-- (4) æ–°å¢/ç·¨è¼¯åŠŸèƒ½: æ‡¸æµ® â€œ+â€ ICON -->
        <button @click="openModal('NewTask')"
                class="fixed bottom-24 right-6 w-14 h-14 bg-amber-500 hover:bg-amber-600 text-white rounded-full flex items-center justify-center text-3xl shadow-xl transition transform hover:scale-110 z-40">
            <i class="ph ph-plus"></i>
        </button>

        <!-- åº•éƒ¨å°èˆªæ¬„ (Navigation Bar) -->
        <nav class="bottom-nav fixed bottom-0 left-0 right-0 max-w-xl mx-auto bg-white border-t border-stone-100 flex justify-around items-center h-20 z-30">
            <!-- FIX: ä½¿ç”¨ tab.id ä½œç‚º key -->
            <div v-for="tab in tabs" :key="tab.id"
                 @click="activeTab = tab.id"
                 :class="['flex flex-col items-center p-2 transition cursor-pointer',
                           activeTab === tab.id ? 'text-amber-500 font-bold' : 'text-stone-500 hover:text-stone-700']">
                <i :class="['ph text-2xl', tab.icon]"></i>
                <span class="text-xs mt-1">{{ tab.name }}</span>
            </div>
        </nav>

        <!-- æ¨¡æ…‹è¦–çª— (Modal for New Task/Draft/Resource) -->
        <div v-if="modal.isVisible" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl w-full max-w-md p-6 relative">
                <h3 class="text-xl font-bold mb-4 text-stone-800">æ–°å¢ä»»å‹™ (Modal)</h3>

                <!-- é€™è£¡æ‡‰åŒ…å«è¡¨å–®æ¬„ä½ -->
                <div class="space-y-3">
                    <input type="text" placeholder="ä»»å‹™å…§å®¹ (e.g., é–±è®€ Chapter 5)"
                           class="w-full p-3 rounded-lg border border-stone-300">
                    <select class="w-full p-3 rounded-lg border border-stone-300">
                        <option value="">é¸æ“‡æ‰€å±¬èª²ç¨‹</option>
                        <option v-for="course in courses" :value="course.id" :key="course.id">{{ course.name }}</option>
                    </select>
                    <input type="number" placeholder="é è¨ˆæ™‚é–“ (åˆ†é˜)"
                           class="w-full p-3 rounded-lg border border-stone-300">
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="closeModal" class="px-4 py-2 text-stone-600 rounded-lg hover:bg-stone-100 transition">
                        å–æ¶ˆ
                    </button>
                    <button class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition">
                        å„²å­˜ä»»å‹™
                    </button>
                </div>
                <!-- åˆªé™¤æŒ‰éˆ• (ç·¨è¼¯æ¨¡å¼ä¸­é¡¯ç¤º) -->
                <button v-if="modal.mode === 'Edit'" class="mt-4 w-full py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                    åˆªé™¤ä»»å‹™
                </button>
            </div>
        </div>

    </div>

    <script type="module">
        // Vue å¯¦ä¾‹å¿…é ˆåœ¨ DOM è¼‰å…¥å¾Œå‰µå»º
        window.vueApp = new Vue({
            el: '#app',
            data: {
                // èªè­‰èˆ‡è³‡æ–™åº«ç‹€æ…‹
                isAuthReady: false,
                userId: null,
                // App ç‹€æ…‹
                activeTab: 'daily',
                currentDate: new Date(),
                selectedCourseFilter: 'All',
                detailCourse: null, // FIX: åˆå§‹åŒ– detailCourse
                // åº•éƒ¨å°èˆªæ¬„é¸é … (FIX: åˆå§‹åŒ– tabs é™£åˆ—)
                tabs: [
                    { id: 'daily', name: 'æ¯æ—¥èª²è¡¨', icon: 'ph-calendar-blank-fill' },
                    { id: 'overview', name: 'èª²ç¨‹ç¸½è¦½', icon: 'ph-books-fill' },
                    { id: 'drafts', name: 'å…§å®¹è‰ç¨¿', icon: 'ph-file-text-fill' },
                    { id: 'resources', name: 'å­¸ç¿’è³‡æº', icon: 'ph-lightbulb-fill' },
                ],
                // è³‡æ–™æ¨¡å‹
                courses: [
                    { id: 1, name: 'å¿ƒç†æˆé•·èˆ‡ç¿’æ…£é¤Šæˆ', goal: 'æŒæ¡æƒ…ç·’èª¿é©èˆ‡é«˜ç”Ÿç”¢åŠ›ç¿’æ…£', outcome: 'æ¯æ—¥åæ€æ—¥è¨˜ã€è¡Œå‹•æ¸…å–®', totalTasks: 18, completedCount: 12, actualTime: 5.5, learningContent: [{ id: 'A', name: 'ç„¦æ…®ä¸‰å•ç·´ç¿’' }, { id: 'B', name: 'æ—©ä¸Šå†¥æƒ³ 10 åˆ†é˜' }] },
                    { id: 2, name: 'é‡‘èèˆ‡ AI å°ˆæ¥­æŠ€èƒ½', goal: 'æ‡‰ç”¨ GenAI æå‡é‡‘èæ±ºç­–æ•ˆç‡', outcome: 'ä¸‰ä»½å¸‚å ´åˆ†æå ±å‘Š', totalTasks: 25, completedCount: 5, actualTime: 1.2, learningContent: [{ id: 'C', name: 'å­¸ç¿’ Python é‡‘èå¥—ä»¶' }, { id: 'D', name: 'æ’°å¯« AI å ±å‘Šè‰ç¨¿' }] },
                    { id: 3, name: 'è²¡å‹™è¦åŠƒèˆ‡æŠ•è³‡çµ„åˆ', goal: 'å»ºç«‹ä¸¦è¿½è¹¤ç©©å¥çš„è²¡å‹™æ¨¡å‹', outcome: 'å­£åº¦è³‡ç”¢å ±å‘Š', totalTasks: 15, completedCount: 8, actualTime: 3.0, learningContent: [{ id: 'E', name: 'é–±è®€ã€Šå¯Œçˆ¸çˆ¸çª®çˆ¸çˆ¸ã€‹' }] },
                    { id: 4, name: 'è‹±èªæºé€šèˆ‡è¡¨é”', goal: 'èƒ½æµæš¢é€²è¡Œå¤–å•†æœƒè­°èˆ‡ç°¡å ±', outcome: 'ä¸‰æ¬¡å¤–å•†æ¨¡æ“¬æœƒè­°éŒ„éŸ³', totalTasks: 30, completedCount: 20, actualTime: 7.0, learningContent: [{ id: 'F', name: 'ç·´ç¿’ä¸»é¡Œ M ç°¡å ±' }] },
                    { id: 5, name: 'å…§å®¹å‰µä½œèˆ‡å€‹äººå“ç‰Œ', goal: 'æ¯é€±ç”¢å‡ºé«˜å“è³ªçš„çŸ¥è­˜å…§å®¹', outcome: 'åç¯‡éƒ¨è½æ ¼è‰ç¨¿', totalTasks: 12, completedCount: 4, actualTime: 2.1, learningContent: [{ id: 'G', name: 'ç™¼æƒ³ä¸»é¡Œ Q' }, { id: 'H', name: 'ç·¨è¼¯éƒ¨è½æ ¼è‰ç¨¿' }] },
                    { id: 6, name: 'ç”Ÿæ´»ç¾æ„Ÿèˆ‡é«”é©—', goal: 'æå‡ç”Ÿæ´»å“è³ªèˆ‡éˆæ„Ÿæ•æ‰èƒ½åŠ›', outcome: 'ç…§ç‰‡éˆæ„Ÿé›†ã€æ·±åº¦é«”é©—ç´€éŒ„', totalTasks: 10, completedCount: 10, actualTime: 4.8, learningContent: [{ id: 'P', name: 'ç´€éŒ„ç”Ÿæ´»éˆæ„Ÿ' }, { id: 'Q', name: 'æ·±åº¦é«”é©—æ´»å‹• P' }, { id: 'R', name: 'æ¯æ—¥å›é¡§' }] },
                ],
                tasks: [], // æ¯æ—¥ä»»å‹™
                drafts: [], // å…§å®¹è‰ç¨¿
                resources: [], // å­¸ç¿’è³‡æº
                // Modal ç‹€æ…‹
                modal: {
                    isVisible: false,
                    mode: 'NewTask', // NewTask, EditTask, NewDraft, NewResource
                    data: {}
                }
            },
            computed: {
                // ç”Ÿæˆæœªä¾†ä¸ƒå¤©çš„æ—¥æœŸç¯„åœ (ç”¨æ–¼æ—¥æœŸé¸å–®)
                dateRange() {
                    const days = [];
                    const today = this.formatDate(new Date(), 'YYYY-MM-DD');
                    for (let i = -3; i <= 3; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() + i);
                        const dateString = this.formatDate(date, 'YYYY-MM-DD');
                        days.push({
                            date: date,
                            dateString: dateString, // æ–°å¢ string æ ¼å¼ç”¨æ–¼ key
                            dayOfWeek: ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][date.getDay()],
                            dayOfMonth: date.getDate(),
                            isToday: dateString === today,
                            isSelected: this.formatDate(this.currentDate, 'YYYY-MM-DD') === dateString
                        });
                    }
                    return days;
                },
                // æ ¹æ“šæ—¥æœŸå’Œç¯©é¸å™¨éæ¿¾ä»»å‹™
                filteredTasks() {
                    const selectedDate = this.formatDate(this.currentDate, 'YYYY-MM-DD');
                    return this.tasks
                        .filter(task => this.formatDate(task.date, 'YYYY-MM-DD') === selectedDate)
                        .filter(task => this.selectedCourseFilter === 'All' || task.courseId === this.selectedCourseFilter);
                },
                // è¨ˆç®—ç¸½ç´¯è¨ˆåŸ·è¡Œæ™‚é–“ (å°æ™‚)
                totalActualTime() {
                    return (this.courses.reduce((sum, c) => sum + c.actualTime, 0)).toFixed(1);
                },
                // è¨ˆç®—èª²ç¨‹é€²åº¦ç™¾åˆ†æ¯”
                courseProgress() {
                    const progress = {};
                    this.courses.forEach(course => {
                        if (course.totalTasks === 0) {
                            progress[course.id] = 0;
                        } else {
                            progress[course.id] = Math.floor((course.completedCount / course.totalTasks) * 100);
                        }
                    });
                    return progress;
                },
                // èª²ç¨‹è©³æƒ…çµ±è¨ˆæ•¸æ“š (æ¨¡æ“¬æ•¸æ“š)
                detailCourseStats() {
                    if (!this.detailCourse) return { actualTime: 0, completedCount: 0 };
                    return {
                        actualTime: this.detailCourse.actualTime,
                        completedCount: this.detailCourse.completedCount
                    };
                }
            },
            watch: {
                // ç›£è½èªè­‰ç‹€æ…‹ï¼Œä¸€æ—¦æº–å‚™å¥½å°±é–‹å§‹è¼‰å…¥è³‡æ–™
                isAuthReady(isReady) {
                    if (isReady && this.userId) {
                        this.fetchData('tasks');
                        this.fetchData('drafts');
                        this.fetchData('resources');
                    }
                }
            },
            methods: {
                // æ ¼å¼åŒ–æ—¥æœŸæ™‚é–“
                formatDate(date, format) {
                    if (!date) return '';
                    // ç¢ºä¿è¼¸å…¥æ˜¯ Date å°è±¡
                    const d = date instanceof Date ? date : (date.toDate ? date.toDate() : new Date(date));

                    const pad = (n) => (n < 10 ? '0' + n : n);
                    let str = format;
                    str = str.replace('YYYY', d.getFullYear());
                    str = str.replace('MM', pad(d.getMonth() + 1));
                    str = str.replace('DD', pad(d.getDate()));
                    str = str.replace('HH', pad(d.getHours()));
                    str = str.replace('mm', pad(d.getMinutes()));
                    return str;
                },
                // å°èˆªåˆ°é¸å®šæ—¥æœŸ
                selectDate(date) {
                    this.currentDate = date;
                },
                // æ ¹æ“šè³‡æºé¡åˆ¥è¿”å› Phosphor Icon
                getResourceIcon(category) {
                    const icons = {
                        'æ›¸ç±/æ•™æ': 'ph-book-open-text',
                        'Podcast/Vlog é€£çµ': 'ph-monitor-play',
                        'å·¥å…·ç¶²ç«™/è»Ÿé«”': 'ph-code',
                        'æ–‡ä»¶/æª”æ¡ˆè·¯å¾‘': 'ph-folder-simple-fill',
                        'é«”é©—æ´»å‹• P': 'ph-leaf-light'
                    };
                    return icons[category] || 'ph-link';
                },
                // é–‹å•Ÿ Modal
                openModal(mode, data = {}) {
                    this.modal.mode = mode;
                    this.modal.data = data;
                    this.modal.isVisible = true;
                },
                // é—œé–‰ Modal
                closeModal() {
                    this.modal.isVisible = false;
                    this.modal.data = {};
                },
                // æ¨¡æ“¬èª²ç¨‹è©³æƒ…é 
                viewCourseDetail(courseId) {
                    this.detailCourse = this.courses.find(c => c.id === courseId);
                },
                // Firestore æ•¸æ“šè¼‰å…¥èˆ‡å¯¦æ™‚ç›£è½
                fetchData(collectionName) {
                    if (!window.dbFunctions || !this.userId) return;

                    const { collection, query, where, onSnapshot } = window.dbFunctions;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    // ç§æœ‰è³‡æ–™è·¯å¾‘: /artifacts/{appId}/users/{userId}/{collectionName}
                    const dataPath = `/artifacts/${appId}/users/${this.userId}/${collectionName}`;

                    console.log(`æ­£åœ¨ç›£è½: ${dataPath}`);

                    const q = query(collection(window.db, dataPath));

                    onSnapshot(q, (snapshot) => {
                        const items = [];
                        snapshot.forEach((doc) => {
                            // è½‰æ› Firestore Timestamp ç‚º Date å°è±¡
                            const data = doc.data();
                            if (data.date && data.date.toDate) data.date = data.date.toDate();
                            if (data.completedAt && data.completedAt.toDate) data.completedAt = data.completedAt.toDate();
                            items.push({ id: doc.id, ...data });
                        });

                        // æ›´æ–° Vue å¯¦ä¾‹çš„è³‡æ–™
                        if (collectionName === 'tasks') this.tasks = items;
                        if (collectionName === 'drafts') this.drafts = items.sort((a, b) => b.date - a.date); // å€’åº
                        if (collectionName === 'resources') this.resources = items;

                        console.log(`å·²è¼‰å…¥ ${items.length} ç­† ${collectionName} è³‡æ–™`);
                    }, (error) => {
                        console.error(`ç›£è½ ${collectionName} å¤±æ•—:`, error);
                    });
                },
                // æ¨¡æ“¬åˆ‡æ›ä»»å‹™å®Œæˆç‹€æ…‹
                async toggleTaskCompletion(taskId, isCompleted) {
                    if (!window.dbFunctions || !this.userId) {
                        console.error("Firebase æˆ– UserId å°šæœªæº–å‚™å¥½ï¼Œç„¡æ³•æ›´æ–°ã€‚");
                        return;
                    }

                    const taskRef = window.dbFunctions.doc(window.db, `/artifacts/${__app_id}/users/${this.userId}/tasks`, taskId);
                    const updateData = {
                        completed: isCompleted,
                        completedAt: isCompleted ? window.dbFunctions.serverTimestamp() : null,
                        actualTime: isCompleted ? (Math.random() * 30 + 10).toFixed(0) : 0 // æ¨¡æ“¬éš¨æ©Ÿå¯¦éš›è€—æ™‚
                    };

                    try {
                        await window.dbFunctions.updateDoc(taskRef, updateData);
                        console.log("ä»»å‹™ç‹€æ…‹æ›´æ–°æˆåŠŸ:", taskId);
                    } catch (error) {
                        console.error("æ›´æ–°ä»»å‹™ç‹€æ…‹å¤±æ•—:", error);
                    }
                },
            },
            created() {
                // æª¢æŸ¥æ˜¯å¦æœ‰ Firestore å…¨å±€è®Šæ•¸
                if (!window.firebaseApp) {
                    // å¦‚æœæ²’æœ‰ Firebase æœå‹™ï¼Œå‰‡è¼‰å…¥æ¨¡æ“¬æ•¸æ“š
                    this.tasks = [
                        { id: 't1', date: new Date(), courseId: 1, content: 'è®€ã€ŠThe Mountain Is Youã€‹', estimatedTime: 15, actualTime: 12, completed: true, completedAt: new Date(new Date().setHours(8, 0, 0)) },
                        { id: 't2', date: new Date(), courseId: 2, content: 'æ’°å¯« AI å ±å‘Šè‰ç¨¿', estimatedTime: 60, actualTime: 0, completed: false },
                        { id: 't3', date: new Date(), courseId: 6, content: 'è¨˜éŒ„ç”Ÿæ´»éˆæ„Ÿ P', estimatedTime: 30, actualTime: 0, completed: false },
                        { id: 't4', date: new Date(new Date().setDate(new Date().getDate() + 1)), courseId: 3, content: 'å»ºç«‹ Q3 è²¡å‹™æ¨¡å‹', estimatedTime: 90, actualTime: 0, completed: false },
                    ];
                    this.drafts = [
                        { id: 'd1', date: new Date(), courseId: 1, title: 'ç„¦æ…®ä¸‰å•åæ€', content: 'ä»Šå¤©é€éä¸‰å•æ³•ï¼Œæˆ‘ç™¼ç¾ç„¦æ…®çš„æ ¹æºåœ¨æ–¼å°æœªä¾†æ§åˆ¶æ„Ÿçš„ç¼ºä¹...' },
                        { id: 'd2', date: new Date(new Date().setDate(new Date().getDate() - 1)), courseId: 5, title: 'å…§å®¹ä¸»é¡Œ Q ç™¼æƒ³', content: 'æˆ‘æ±ºå®šä»¥ã€ŒçŸ¥è­˜ç„¦æ…®ã€ç‚ºé¡Œï¼Œå¾å…©å€‹è§’åº¦åˆ‡å…¥ï¼Œç¬¬ä¸€æ˜¯è¼¸å…¥éå¤šï¼Œç¬¬äºŒæ˜¯æ²’æœ‰è¼¸å‡º...' },
                    ];
                    this.resources = [
                        { id: 'r1', courseId: 1, name: 'Atomic Habits', category: 'æ›¸ç±/æ•™æ', url: '#', notes: 'é—œæ–¼åŸå­ç¿’æ…£çš„å»ºç«‹' },
                        { id: 'r2', courseId: 4, name: 'å¤–å•†ä¸»é¡Œ M ç¯„æœ¬', category: 'æ–‡ä»¶/æª”æ¡ˆè·¯å¾‘', url: '#', notes: 'é‡è¦ç°¡å ±ç¯„ä¾‹' },
                    ];
                }
            }
        });
    </script>
</body>
</html>
